<!DOCTYPE html>
<html lang="es">
{% load static %}

<head>
  <meta charset="UTF-8">
  <title>{% block title %}Panel de Usuario{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Modern Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0"
    rel="stylesheet">
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- CSS Personalizado -->
  <link rel="stylesheet" href="{% static 'usuarios/css/menu.css' %}">

  {% block extra_css %}{% endblock %}
</head>

{% if not user.is_authenticated %}
<script>
  window.location.href = "{% url 'usuarios:login' %}";
</script>
{% endif %}

<body>
  <!-- Sidebar -->
  <aside class="sidebar collapsed">
    <header class="sidebar-header">
      <a href="#" class="header-logo">
        <img src="{% static 'usuarios/img/logo redondo.png' %}" alt="Logo Tienda" class="logo-main">
      </a>
      <button class="toggler sidebar-toggler">
        <span class="material-symbols-rounded">chevron_left</span>
      </button>
      <button class="toggler menu-toggler">
        <span class="material-symbols-rounded">menu</span>
      </button>
    </header>

    <nav class="sidebar-nav">
      <ul class="nav-list main-nav">
        <li class="nav-item">
          <a href="{% url 'dashboard:menu' %}"
            class="nav-link {% if request.resolver_match.namespace == 'dashboard' %}active{% endif %}">
            <span class="nav-icon material-symbols-rounded">dashboard</span>
            <span class="nav-label">Panel</span>
          </a>
          <span class="nav-tooltip">Panel</span>
        </li>
        <li class="nav-item">
          <a href="{% url 'clientes:menu_clientes' %}"
            class="nav-link {% if 'clientes' in request.path %}active{% endif %}">
            <span class="nav-icon material-symbols-rounded">person_add</span>
            <span class="nav-label">Clientes</span>
          </a>
          <span class="nav-tooltip">Clientes</span>
        </li>
        <li class="nav-item">
          <a href="{% url 'productos:menu_productos' %}"
            class="nav-link {% if 'productos' in request.path %}active{% endif %}">
            <span class="nav-icon material-symbols-rounded">inventory_2</span>
            <span class="nav-label">Productos</span>
          </a>
          <span class="nav-tooltip">Productos</span>
        </li>
        <!-- Lotes - Solo Dueño y Administrador -->
        {% if is_dueno or is_admin %}
        <li class="nav-item">
          <a href="{% url 'lotes:menu_lote' %}" class="nav-link {% if 'lotes' in request.path %}active{% endif %}">
            <span class="nav-icon material-symbols-rounded">pallet</span>
            <span class="nav-label">Lotes</span>
          </a>
          <span class="nav-tooltip">Lotes</span>
        </li>
        {% endif %}
        <!-- NUEVO BOTÓN DE VENTAS -->
        <li class="nav-item">
          <a href="{% url 'ventas:menu_ventas' %}" class="nav-link {% if 'ventas' in request.path %}active{% endif %}">
            <span class="nav-icon material-symbols-rounded">shopping_cart</span>
            <span class="nav-label">Ventas</span>
          </a>
          <span class="nav-tooltip">Ventas</span>
        </li>

        <li class="nav-item">
          <a href="{% url 'cuentas_pendientes:menu_cuentas' %}"
            class="nav-link {% if 'cuentas-pendientes' in request.path %}active{% endif %}">
            <span class="nav-icon material-symbols-rounded">payments</span>
            <span class="nav-label">Cuentas Pendientes</span>
          </a>
          <span class="nav-tooltip">Cuentas Pendientes</span>
        </li>

        <li class="nav-item">
          <a href="{% url 'cierre_caja:menu_cierre_caja' %}"
            class="nav-link {% if 'cierre_caja' in request.path %}active{% endif %}">
            <span class="nav-icon material-symbols-rounded">point_of_sale</span>
            <span class="nav-label">Cierre de Caja</span>
          </a>
          <span class="nav-tooltip">Cierre de Caja</span>
        </li>
        
        <!-- Estadísticas - Solo Dueño y Administrador -->
        {% if is_dueno or is_admin %}
        <li class="nav-item">
          <a href="{% url 'estadisticas:menu_estadisticas' %}"
            class="nav-link {% if 'estadisticas' in request.path %}active{% endif %}">
            <span class="nav-icon material-symbols-rounded">bar_chart</span>
            <span class="nav-label">Estadísticas</span>
          </a>
          <span class="nav-tooltip">Estadísticas</span>
        </li>
        {% endif %}

        <!-- Configuración - Solo Dueño -->
        {% if is_dueno %}
        <li class="nav-item">
          <a href="{% url 'usuarios:menu_configuracion' %}" class="nav-link {% if 'configuracion' in request.path %}active{% endif %}">
            <span class="nav-icon material-symbols-rounded">settings</span>
            <span class="nav-label">Configuración</span>
          </a>
          <span class="nav-tooltip">Configuración</span>
        </li>
        {% endif %}
      </ul>


      <ul class="nav-list secondary-nav">
        <!-- BOTÓN DE TOUR -->
        <li class="nav-item">
          <a href="#" id="tour-btn" onclick="startTour(); return false;" class="nav-link text-white">
            <span class="nav-icon material-symbols-rounded">help</span>
            <span class="nav-label">Ayuda / Tour</span>
          </a>
          <span class="nav-tooltip">Ayuda / Tour</span>
        </li>

        <li class="nav-item">
          <form method="post" action="{% url 'usuarios:logout' %}" class="logout-form nav-link">
            {% csrf_token %}
            <button type="submit" class="btn text-start text-white w-100">
              <span class="nav-icon material-symbols-rounded">logout</span>
              <span class="nav-label">Cerrar sesión</span>
            </button>
          </form>
          <span class="nav-tooltip">Cerrar sesión</span>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <div class="content">
    {% block content %}
    <!-- Contenido específico se insertará aquí -->
    {% endblock %}
  </div>

  <!-- Intro.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/7.2.0/introjs.min.css">

  <!-- Bootstrap 5 JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Intro.js JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/7.2.0/intro.min.js"></script>
  
  <!-- Tour Script -->
  <script src="{% static 'usuarios/js/tour.js' %}"></script>

  <!-- JavaScript Personalizado -->

  <!-- JavaScript Personalizado -->
  <script src="{% static 'usuarios/js/menu.js' %}"></script>

  {% block extra_js %}{% endblock %}
  <script>
    // Script global para desactivar autocompletado en todo el sistema
    document.addEventListener('DOMContentLoaded', function() {
      const disableAutocomplete = () => {
        const elements = document.querySelectorAll('form, input');
        elements.forEach(el => {
          el.setAttribute('autocomplete', 'off');
        });
      };
      
      disableAutocomplete();
      
      // Observar cambios en el DOM para nuevos elementos (opcional pero recomendado para SPAs o modales dinámicos)
      const observer = new MutationObserver((mutations) => {
        disableAutocomplete();
      });
      
      observer.observe(document.body, { childList: true, subtree: true });
    });
  </script>
</body>

</html>