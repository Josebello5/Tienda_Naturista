<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Cierre de Caja #{{ cierre.ID_Cierre }}</title>
    <style>
        @page {
            size: letter portrait;
            margin: 1.5cm;
        }

        body {
            font-family: Helvetica, sans-serif;
            font-size: 10pt;
            color: #333;
        }

        /* Header igual al reporte de productos */
        .header {
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .header-table {
            width: 100%;
        }

        .header-table td {
            vertical-align: middle;
            padding: 0;
        }

        .logo-img {
            width: 70px;
            height: 70px;
        }

        .header h1 {
            color: #4CAF50;
            font-size: 22pt;
            margin: 0;
        }

        .header .slogan {
            color: #666;
            font-size: 12pt;
            margin: 3px 0;
        }

        .header .report-info {
            color: #333;
            font-size: 9pt;
            margin-top: 5px;
        }

        /* Tabla principal igual al reporte de productos */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .data-table th {
            background-color: #4CAF50;
            color: white;
            padding: 10px 8px;
            text-align: left;
            font-size: 9pt;
            font-weight: bold;
        }

        .data-table td {
            padding: 10px 8px;
            font-size: 9pt;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        /* Estado */
        .estado {
            padding: 12px;
            text-align: center;
            font-size: 12pt;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .estado-ok {
            background-color: #e8f5e9;
            border: 2px solid #4CAF50;
            color: #2E7D32;
        }

        .estado-mal {
            background-color: #ffebee;
            border: 2px solid #e53935;
            color: #c62828;
        }

        /* Colores */
        .verde {
            color: #2E7D32;
            font-weight: bold;
        }

        .azul {
            color: #1565C0;
            font-weight: bold;
        }

        .rojo {
            color: #c62828;
            font-weight: bold;
        }

        /* Sección título */
        .section-title {
            background-color: #4CAF50;
            color: white;
            padding: 8px 10px;
            font-weight: bold;
            font-size: 10pt;
            margin-top: 20px;
        }

        /* Notas */
        .notas {
            padding: 12px;
            background-color: #fff8e1;
            border: 1px solid #ffc107;
            margin: 20px 0;
        }

        /* Firmas */
        .firmas {
            margin-top: 50px;
            width: 100%;
        }

        .firma-linea {
            border-top: 1px solid #333;
            padding-top: 8px;
            text-align: center;
            font-size: 9pt;
            color: #666;
        }
    </style>
</head>

<body>

    <!-- HEADER IGUAL AL REPORTE DE PRODUCTOS -->
    <div class="header">
        <table class="header-table">
            <tr>
                <td width="85">
                    {% if logo_url %}
                    <img src="{{ logo_url }}" class="logo-img">
                    {% endif %}
                </td>
                <td>
                    <h1>Tienda Naturista</h1>
                    <div class="slogan">"Algo más para tu salud"</div>
                    <div class="report-info">
                        <strong>Comprobante de Cierre de Caja</strong> | {{ fecha_formateada }}
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <!-- INFO DEL CIERRE -->
    <table class="data-table">
        <tr>
            <th colspan="4">INFORMACIÓN DEL CIERRE</th>
        </tr>
        <tr>
            <td width="25%"><strong>Fecha de Cierre:</strong></td>
            <td width="25%">{{ fecha_cierre_formateada }}</td>
            <td width="25%"><strong>Usuario:</strong></td>
            <td width="25%">{{ cierre.Usuario.username }}</td>
        </tr>
        <tr>
            <td><strong>ID Cierre:</strong></td>
            <td>#{{ cierre.ID_Cierre }}</td>
            <td><strong>Generado:</strong></td>
            <td>{{ fecha_formateada }}</td>
        </tr>
    </table>

    <!-- RESUMEN DE TOTALES -->
    <table class="data-table">
        <tr>
            <th width="40%">Concepto</th>
            <th width="30%" class="text-right">Bolívares (Bs)</th>
            <th width="30%" class="text-right">Divisas ($)</th>
        </tr>
        <tr>
            <td><strong>Total Sistema</strong></td>
            <td class="text-right">Bs {{ total_sistema_bs_formatted }}</td>
            <td class="text-right">$ {{ total_sistema_usd_formatted }}</td>
        </tr>
        <tr>
            <td><strong>Total Real (Caja)</strong></td>
            <td class="text-right">Bs {{ total_real_bs_formatted }}</td>
            <td class="text-right">$ {{ total_real_usd_formatted }}</td>
        </tr>
        <tr>
            <td><strong>Diferencia</strong></td>
            <td
                class="text-right {% if cierre.diferencia_bs > 0 %}azul{% elif cierre.diferencia_bs < 0 %}rojo{% else %}verde{% endif %}">
                Bs {{ diferencia_bs_formatted }}
            </td>
            <td
                class="text-right {% if cierre.diferencia_usd > 0 %}azul{% elif cierre.diferencia_usd < 0 %}rojo{% else %}verde{% endif %}">
                $ {{ diferencia_usd_formatted }}
            </td>
        </tr>
    </table>

    <!-- ESTADO -->
    {% if cierre.Diferencia_Total == 0 %}
    <div class="estado estado-ok">✓ CIERRE CUADRADO - Todo en orden</div>
    {% else %}
    <div class="estado estado-mal">⚠ DESCUADRE DETECTADO</div>
    {% endif %}

    <!-- DETALLE POR MÉTODO -->
    <table class="data-table">
        <tr>
            <th width="25%">Método de Pago</th>
            <th width="25%" class="text-right">Sistema</th>
            <th width="25%" class="text-right">Real</th>
            <th width="25%" class="text-center">Diferencia</th>
        </tr>
        <tr>
            <td>Efectivo Bolívares</td>
            <td class="text-right">Bs {{ sistema_efectivo_bs_formatted }}</td>
            <td class="text-right">Bs {{ real_efectivo_bs_formatted }}</td>
            <td
                class="text-center {% if diferencias.efectivo_bs < 0 %}rojo{% elif diferencias.efectivo_bs > 0 %}azul{% else %}verde{% endif %}">
                {{ dif_efectivo_bs_formatted }}</td>
        </tr>
        <tr>
            <td>Efectivo Dólares</td>
            <td class="text-right">$ {{ sistema_efectivo_usd_formatted }}</td>
            <td class="text-right">$ {{ real_efectivo_usd_formatted }}</td>
            <td
                class="text-center {% if diferencias.efectivo_usd < 0 %}rojo{% elif diferencias.efectivo_usd > 0 %}azul{% else %}verde{% endif %}">
                {{ dif_efectivo_usd_formatted }}</td>
        </tr>
        <tr>
            <td>Punto de Venta</td>
            <td class="text-right">Bs {{ sistema_punto_venta_formatted }}</td>
            <td class="text-right">Bs {{ real_punto_venta_formatted }}</td>
            <td
                class="text-center {% if diferencias.punto_venta < 0 %}rojo{% elif diferencias.punto_venta > 0 %}azul{% else %}verde{% endif %}">
                {{ dif_punto_venta_formatted }}</td>
        </tr>
        <tr>
            <td>Pago Móvil</td>
            <td class="text-right">Bs {{ sistema_pago_movil_formatted }}</td>
            <td class="text-right">Bs {{ real_pago_movil_formatted }}</td>
            <td
                class="text-center {% if diferencias.pago_movil < 0 %}rojo{% elif diferencias.pago_movil > 0 %}azul{% else %}verde{% endif %}">
                {{ dif_pago_movil_formatted }}</td>
        </tr>
        <tr>
            <td>Transferencia</td>
            <td class="text-right">Bs {{ sistema_transferencia_formatted }}</td>
            <td class="text-right">Bs {{ real_transferencia_formatted }}</td>
            <td
                class="text-center {% if diferencias.transferencia < 0 %}rojo{% elif diferencias.transferencia > 0 %}azul{% else %}verde{% endif %}">
                {{ dif_transferencia_formatted }}</td>
        </tr>
        <tr>
            <td>Tarjeta / Otros</td>
            <td class="text-right">Bs {{ sistema_tarjeta_formatted }}</td>
            <td class="text-right">Bs {{ real_tarjeta_formatted }}</td>
            <td
                class="text-center {% if diferencias.tarjeta < 0 %}rojo{% elif diferencias.tarjeta > 0 %}azul{% else %}verde{% endif %}">
                {{ dif_tarjeta_formatted }}</td>
        </tr>
    </table>

    {% if cierre.Notas %}
    <div class="notas">
        <strong>Notas:</strong><br>
        {{ cierre.Notas|linebreaksbr }}
    </div>
    {% endif %}

    <!-- FIRMAS -->
    <table class="firmas">
        <tr>
            <td width="40%">
                <div class="firma-linea">Firma Cajero/a</div>
            </td>
            <td width="20%"></td>
            <td width="40%">
                <div class="firma-linea">Firma Supervisor/a</div>
            </td>
        </tr>
    </table>

</body>

</html>