<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Historial de Cierres de Caja</title>
    <style>
        @page {
            size: letter portrait;
            margin-top: 4.5cm;
            margin-bottom: 1.5cm;
            margin-left: 1cm;
            margin-right: 1cm;

            @frame header_frame {
                -pdf-frame-content: header_content;
                left: 1cm;
                width: 19.59cm;
                top: 0.5cm;
                height: 4cm;
            }

            @frame footer_frame {
                -pdf-frame-content: footer_content;
                left: 1cm;
                width: 19.59cm;
                bottom: 0cm;
                height: 1cm;
            }
        }

        body {
            font-family: Helvetica, sans-serif;
            font-size: 9pt;
            color: #333;
        }

        #header_content {
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        #footer_content {
            text-align: center;
            font-size: 8pt;
            color: #666;
            padding-top: 5px;
            border-top: 1px solid #ddd;
        }

        .header-table {
            width: 100%;
            border: none;
            margin-bottom: 0;
        }

        .header-table td {
            border: none;
            padding: 0;
            vertical-align: middle;
        }

        .logo-img {
            width: 70px;
            height: 70px;
        }

        h1 {
            color: #1b5e20;
            font-size: 16pt;
            margin: 0;
            text-transform: uppercase;
            line-height: 1.2;
        }

        h2 {
            color: #333;
            font-size: 12pt;
            margin: 3px 0 0 0;
            font-weight: normal;
        }

        .meta-info {
            font-size: 8pt;
            color: #444;
            margin-top: 5px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            table-layout: fixed;
        }

        .data-table th {
            background-color: #4CAF50;
            color: white;
            padding: 10px 8px;
            text-align: center;
            font-weight: bold;
            font-size: 9pt;
        }

        .data-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #ddd;
            font-size: 8pt;
            vertical-align: top;
            overflow: hidden;
        }

        .row-even {
            background-color: #f5f5f5;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .text-left {
            text-align: left;
        }

        .mono {
            font-family: Courier, monospace;
        }

        .status-cuadre {
            color: #2E7D32;
            font-weight: bold;
        }

        .status-sobra {
            color: #1565C0;
            font-weight: bold;
        }

        .status-falta {
            color: #c62828;
            font-weight: bold;
        }

        .sub-value {
            font-size: 7pt;
        }

        .totals-row {
            background-color: #e8f5e9;
        }

        .totals-row td {
            border-top: 2px solid #4CAF50;
            padding: 12px 8px;
            font-weight: bold;
        }

        .badge-dueno {
            color: #e74c3c;
            font-weight: bold;
        }

        .badge-admin {
            color: #3498db;
            font-weight: bold;
        }

        .badge-cajero {
            color: #17a2b8;
            font-weight: bold;
        }

        .badge-default {
            color: #4CAF50;
            font-weight: bold;
        }

        .notas-cell {
            font-size: 7pt;
            color: #555;
            -pdf-word-wrap: CJK;
            word-wrap: break-word;
            word-break: break-all;
        }
    </style>
</head>

<body>
    <div id="header_content">
        <table class="header-table">
            <tr>
                <td width="90">
                    {% if logo_url %}
                    <img src="{{ logo_url }}" class="logo-img">
                    {% endif %}
                </td>
                <td>
                    <h1>Tienda Naturista</h1>
                    <h2>"Algo más para tu salud"</h2>
                    <div class="meta-info">
                        <strong>Historial de Cierres de Caja</strong> | {{ fecha_generacion|date:"d/m/Y H:i" }}
                        {% if filtros_info %}
                        <br><span style="color: #d32f2f;">{{ filtros_info }}</span>
                        {% endif %}
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <div id="footer_content">
        Página <pdf:pagenumber> de <pdf:pagecount>
    </div>

    <table class="data-table">
        <thead>
            <tr>
                <th style="width: 11%;">Fecha</th>
                <th style="width: 15%;">Usuario</th>
                <th style="width: 16%;">Total Sistema</th>
                <th style="width: 16%;">Total Real</th>
                <th style="width: 16%;">Diferencia</th>
                <th style="width: 26%;">Notas</th>
            </tr>
        </thead>
        <tbody>
            {% for cierre in cierres %}
            <tr{% if forloop.counter|divisibleby:2 %} class="row-even" {% endif %}>
                <td class="text-center"><strong>{{ cierre.fecha }}</strong></td>
                <td class="text-left">
                    <span class="badge-{{ cierre.rol_class }}">({{ cierre.inicial }})</span>
                    {{ cierre.usuario }}
                </td>
                <td class="text-right mono">
                    Bs {{ cierre.sistema_bs }}<br>
                    <span class="sub-value">Ref {{ cierre.sistema_usd }}</span>
                </td>
                <td class="text-right mono">
                    Bs {{ cierre.real_bs }}<br>
                    <span class="sub-value">Ref {{ cierre.real_usd }}</span>
                </td>
                <td class="text-center">
                    <span class="status-{{ cierre.estado_bs }}">
                        Bs {% if cierre.dif_bs > 0 %}+{% endif %}{{ cierre.dif_bs_fmt }}
                    </span><br>
                    <span class="status-{{ cierre.estado_usd }}" style="font-size: 7pt;">
                        Ref {% if cierre.dif_usd > 0 %}+{% endif %}{{ cierre.dif_usd_fmt }}
                    </span>
                </td>
                <td class="notas-cell">{{ cierre.notas|default:"-" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: 20px;">
                        No se encontraron cierres de caja con los filtros seleccionados.
                    </td>
                </tr>
                {% endfor %}

                {% if cierres %}
                <tr class="totals-row">
                    <td colspan="2" class="text-left"><strong>TOTALES</strong></td>
                    <td class="text-right mono">
                        Bs {{ total_sistema_bs }}<br>
                        <span class="sub-value">Ref {{ total_sistema_usd }}</span>
                    </td>
                    <td class="text-right mono">
                        Bs {{ total_real_bs }}<br>
                        <span class="sub-value">Ref {{ total_real_usd }}</span>
                    </td>
                    <td class="text-center">
                        <span class="status-{{ total_estado_bs }}">
                            Bs {% if total_dif_bs > 0 %}+{% endif %}{{ total_dif_bs_fmt }}
                        </span><br>
                        <span class="status-{{ total_estado_usd }}" style="font-size: 7pt;">
                            Ref {% if total_dif_usd > 0 %}+{% endif %}{{ total_dif_usd_fmt }}
                        </span>
                    </td>
                    <td></td>
                </tr>
                {% endif %}
        </tbody>
    </table>

    <div style="margin-top: 15px; text-align: right; color: #666; font-size: 8pt;">
        <strong>Total de registros:</strong> {{ cierres|length }}
    </div>

</body>

</html>